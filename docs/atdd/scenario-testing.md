# 受け入れテスト（シナリオテストケース）作成ガイド

このドキュメントは、**ATDD（Acceptance Test-Driven Development）** に基づいた受け入れテストケースの作成方法を説明します。

## ATDDにおける受け入れテストの位置づけ

ATDDフローにおいて、受け入れテストは以下のステップで作成されます：

1. **ユーザーストーリーと受け入れ基準の定義**（`acceptance.md`）
2. **テストシナリオの作成**（`scenario-test-case.tsv`）← 本ドキュメントで説明
3. 自動テストの作成（Red）
4. 実装（Green）
5. リファクタリング（Refactor）
6. 受け入れテストの実施

詳細なATDDフローについては、`atdd-flow.md` を参照してください。

---

## テストシナリオの作成方法

### 入力: acceptance.md

`acceptance.md` に記載されている**受け入れ基準（Acceptance Criteria, AC）**を基にテストシナリオを作成します。

各ACは以下の形式で記載されています：

```markdown
#### AC 1.1: 基本的なタイマー操作
- **Given** アプリが待機状態である
- **When** スタートボタンをクリックする
- **Then** 25分（デフォルト）のカウントダウンタイマーが開始される
- **And** タイマー表示が更新される（MM:SS形式）
```

### 出力: scenario-test-case.tsv

TSV形式で、以下の列を持つテストケースを作成します：

| 列名 | 説明 | 例 |
|------|------|-----|
| 機能カテゴリ | テスト対象の機能領域 | デフォルトモード - 基本操作 |
| No. | テストケース番号（連番） | 1-1 |
| テスト項目 | テストの目的を簡潔に | スタートボタンを押すとポモドーロタイマーが開始される |
| Scenario | Given/When/Thenの要約 | 待機状態からタイマーを開始する |
| Given | 前提条件（初期状態） | アプリが待機状態（idle）である |
| When | ユーザー操作 | スタートボタンをクリックする |
| Then | 期待結果 | タイマーが25分（設定値）でカウントダウンを開始し、作業中の画面になる |

---

## テストシナリオ作成の手順

### ステップ1: 受け入れ基準の確認

`acceptance.md` を開き、各ユーザーストーリーの受け入れ基準（AC）を確認します。

**例**: ユーザーストーリー1「デフォルトポモドーロモード」のAC 1.1を確認

### ステップ2: ACからテストケースへの変換

各ACに対して、1つ以上のテストケースを作成します。

#### 変換例

**AC 1.1: 基本的なタイマー操作**

```
Given: アプリが待機状態である
When: スタートボタンをクリックする
Then: 25分（デフォルト）のカウントダウンタイマーが開始される
```

↓ テストケースに変換

```tsv
機能カテゴリ: デフォルトモード - 基本操作
No: 1-1
テスト項目: スタートボタンを押すとポモドーロタイマーが開始される
Scenario: 待機状態からタイマーを開始する
Given: アプリが待機状態（idle）である
When: スタートボタンをクリックする
Then: タイマーが25分（設定値）でカウントダウンを開始し、作業中の画面になる
```

### ステップ3: 実装詳細の補完（既存実装がある場合のみ）

> **注意**: このステップは、**既存実装を持つプロジェクト**（レガシーコードの移行、既存システムのドキュメント化など）で、**ACの抽象度が高い場合**にのみ必要です。
>
> **新規にATDDで開発する場合**、ACを先に具体的に定義するため、このステップは**不要**です。

既存実装があり、ACが抽象的な場合、以下の情報源から詳細を補完します：

1. **状態マシン**（例: `app/machines/pomodoroMachine.ts`）
   - 状態遷移: idle → running → paused → completed
   - イベント: START, PAUSE, RESUME, STOP, COMPLETE など

2. **コンポーネント実装**（例: `app/components/*.tsx`）
   - UI要素: ボタン、入力フィールド、表示内容
   - ユーザー操作: クリック、入力、編集

3. **既存の自動テスト**（ある場合）
   - テストケースからシナリオのヒントを得る

### ステップ4: 非エンジニア向けの表現に変換

技術用語を避け、ユーザーの視点で記述します。

| 技術用語 | 非エンジニア向け表現 |
|---------|---------------------|
| state が idle | アプリが待機状態である |
| state が running | タイマーが実行中である |
| state が paused | タイマーが一時停止中である |
| state が completed | タイマーが完了した |
| START イベント | スタートボタンをクリックする |
| PAUSE イベント | 一時停止ボタンをクリックする |
| remainingTime が 0 | 残り時間が0秒になった |

### ステップ5: 機能網羅性の確認

全ての受け入れ基準がテストケースでカバーされていることを確認します。

**チェックリスト**:
- [ ] 全てのユーザーストーリーがカバーされている
- [ ] 各ACに対応するテストケースが存在する
- [ ] 正常系と異常系の両方がカバーされている
- [ ] エッジケース（境界値）がカバーされている

---

## テストケース作成の実例

### ユーザーストーリー4「計画ポモドーロモード」の場合

#### AC 4.3: 時刻の自動入力（開始時刻）

```markdown
- **Given** 計画モードの待機状態で追加フォームを開いている
- **When** 開始時刻（例：10:00）を入力する
- **Then** 設定されている作業時間（例：25分）と休憩時間（例：5分）から、作業終了時刻（10:25）と休憩終了時刻（10:30）が自動的に入力される
- **And** 自動入力された値は手動で変更可能
```

#### テストケース化

```tsv
機能カテゴリ: 計画モード - ポモドーロ管理
No: 5-7
テスト項目: 開始時刻を入力すると作業終了時刻と休憩終了時刻が自動入力される
Scenario: 時刻の自動入力を確認する
Given: 計画モードの待機状態で追加フォームを開いている
When: 開始時刻（例：10:00）を入力する
Then: 設定されている作業時間（例：25分）と休憩時間（例：5分）から、作業終了時刻（10:25）と休憩終了時刻（10:30）が自動的に入力される
```

**注**: "And" 条件（手動変更可能）は別のテストケースとして分けることも可能です。

---

## 機能カテゴリの分類

テストケースは以下のような機能カテゴリに分類します：

1. **デフォルトモード - 基本操作**: タイマーの開始・停止・一時停止など
2. **デフォルトモード - タイマー完了**: 作業完了・休憩完了時の動作
3. **設定変更**: 作業時間・休憩時間・音量・自動リピートの設定
4. **モード切替**: デフォルトモードと計画モードの切り替え
5. **計画モード - ポモドーロ管理**: ポモドーロの追加・編集・削除
6. **計画モード - タイマー実行**: 時刻ベースのタイマー実行
7. **計画モード - 表示**: 実行中のハイライト表示など
8. **データ永続化**: localStorage による設定の保存

---

## テストケース番号の採番ルール

- **形式**: `カテゴリ番号-連番`
- **例**:
  - 1-1, 1-2, 1-3: デフォルトモード - 基本操作
  - 2-1, 2-2, 2-3: デフォルトモード - タイマー完了
  - 5-1, 5-2, ..., 5-8: 計画モード - ポモドーロ管理
  - 追加テストケース: 5-7, 5-8（後から追加された場合）

---

## TSV形式での出力

### フォーマット

```
機能カテゴリ[TAB]No.[TAB]テスト項目[TAB]Scenario[TAB]Given[TAB]When[TAB]Then
```

### 出力先

- **ファイル名**: `scenario-test-case.tsv`
- **エンコーディング**: UTF-8
- **区切り文字**: タブ（`\t`）
- **改行**: LF または CRLF

### 注意点

- ヘッダー行を含める
- セル内に改行を含めない
- タブ文字はセル内に含めない
- 表形式の装飾（罫線など）は不要

---

## テストケースの実施

### 手動テスト

1. `scenario-test-case.tsv` を開く
2. 各テストケースの Given → When → Then を順に実施
3. 期待結果（Then）が満たされることを確認
4. 結果を記録（Pass/Fail）

### 自動テスト

自動テストは `app/**/__tests__/*.test.tsx` に実装されています。

```bash
# 全テストを実行
npm test

# テストカバレッジ: 48テスト
```

---

## まとめ

このガイドに従うことで：

1. **受け入れ基準（AC）** から **テストシナリオ** を体系的に作成できる
2. **非エンジニア** でも理解できる形式でテストケースを記述できる
3. **ATDD** のプロセスに沿った品質保証が可能になる

### 関連ドキュメント

| ドキュメント | 役割 |
|------------|------|
| [`acceptance.md`](./acceptance.md) | ユーザーストーリーと受け入れ基準（AC） |
| [`scenario-test-case.tsv`](./scenario-test-case.tsv) | テストシナリオ（本ガイドで作成） |
| [`atdd-flow.md`](./atdd-flow.md) | ATDDプロセスガイド |
| `../../app/**/__tests__/*.test.tsx` | 自動テスト（48テスト） |

---

## 参考: テストケース統計の例

- **総テストケース数**: 37件
- **カバーしている機能**:
  - デフォルトモード: 9件
  - 設定変更: 8件
  - モード切替: 2件
  - 計画モード: 18件
  - データ永続化: 2件
- **全受け入れ基準（AC）をカバー**: ✅

受け入れ基準とテストケースの対応表は、`acceptance.md` と `scenario-test-case.tsv` を照らし合わせて確認できます。
